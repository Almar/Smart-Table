/** 
* @version 1.4.12
* @license MIT
*/
!function(e,t){"use strict";function a(e){return e.map(function(e){return{label:e,value:e}})}e.module("smart-table",[]).run(["$templateCache",function(e){e.put("template/smart-table/pagination.html",'<nav ng-if="pages.length >= 2"><ul class="pagination"><li ng-repeat="page in pages" ng-class="{active: page==currentPage}"><a ng-click="selectPage(page)">{{page}}</a></li></ul></nav>')}]),e.module("smart-table").controller("stTableController",["$scope","$parse","$filter","$attrs","$log",function(a,r,n,i,s){function l(){var e="tableData",t=i.stTable;return""===t&&(s.error("st-table has an empty value. No scope variable name is defined. Defaults to '"+e+"'"),t=e),r(t).assign}function c(){return angular.isUndefined(i.stSrc)||""===i.stSrc?function(){s.error("Attribute 'st-src' is undefined!")}:r(i.stSrc)}function o(){f=p(a),b.pagination.start=0,h===!0&&v.pipe(),a.$broadcast("st-safeSrcChanged",null)}var u,p,f,d=l(),g=n("orderBy"),m=n("filter"),b={sort:{},filters:{},pagination:{start:0}},h=!0,v=this;angular.isDefined(i.stSrc)&&(p=c(),f=p(a),d(a,[].concat(f)),a.$watchGroup([function(){var e=p(a);return e?e.length:0},function(){return p(a)}],function(e,t){(t[0]!==e[0]||t[1]!==e[1])&&o()})),this.sortBy=function(t,a){return b.sort.predicate=t,b.sort.reverse=a===!0,e.isFunction(t)?b.sort.functionName=t.name:delete b.sort.functionName,b.pagination.start=0,this.pipe()},this.registerFilter=function(e,a,r){b.filters===t&&(b.filters=Object.create(null));var n=b.filters[e];return n===t&&(n={comparator:a,predicateObject:{},emptyValue:r!==t?r:""},b.filters[e]=n),n},this.search=function(e,t){var a=this.registerFilter("search");this.applyFilter(e,t,a)},this.applyFilter=function(e,t,a){var r=t||"$";return a.predicateObject[r]=e,e===a.emptyValue&&delete a.predicateObject[r],b.pagination.start=0,this.pipe()},this.pipe=function(){var e=b.pagination,r=f;f?(angular.forEach(b.filters,function(e){var t=e.predicateObject;Object.keys(t).length>0&&(r=m(r,t,e.comparator))}),b.sort.predicate&&(r=g(r,b.sort.predicate,b.sort.reverse)),e.number!==t&&(e.numberOfPages=r.length>0?Math.ceil(r.length/e.number):1,e.start=e.start>=r.length?(e.numberOfPages-1)*e.number:e.start,r=r.slice(e.start,e.start+parseInt(e.number)))):r=[],d(a,r)},this.select=function(e,a){var r=f,n=r.indexOf(e);-1!==n&&("single"===a?(e.isSelected=e.isSelected!==!0,u&&(u.isSelected=!1),u=e.isSelected===!0?e:t):r[n].isSelected=!r[n].isSelected)},this.slice=function(e,t){return b.pagination.start=e,b.pagination.number=t,this.pipe()},this.tableState=function(){return b.search=b.filters.search?b.filters.search:{},b},this.setFilterFunction=function(e){m=n(e)},this.setSortFunction=function(e){g=n(e)},this.preventPipeOnWatch=function(){h=!1},this.getUniqueValues=function(e){var a,n=r(e);return f?f.map(function(e){return n(e)}).sort(function(e,t){return"string"==typeof e?e.localeCompare(t):e>t?1:t>e?-1:0}).filter(function(e){return a===t||a!==e?(a=e,!0):!1}):[]}}]).directive("stTable",function(){return{restrict:"A",controller:"stTableController",link:function(e,t,a,r){a.stSetFilter&&r.setFilterFunction(a.stSetFilter),a.stSetSort&&r.setSortFunction(a.stSetSort)}}}),e.module("smart-table").directive("stSearch",["$timeout",function(e){return{require:"^stTable",scope:{predicate:"=?stSearch"},link:function(t,a,r,n){var i,s=n,l=null,c=r.stDelay||400,o=n.registerFilter("search");t.$watch("predicate",function(e,t){e!==t&&(delete o.predicateObject[t],s.applyFilter(a[0].value,e,o))}),t.$watch(function(){return o.predicateObject},function(e){var r=e,n=t.predicate||"$";r&&r[n]!==a[0].value&&(a[0].value=r[n]||"")},!0),a.bind("input keyup",function(a){a=a.originalEvent||a;var r=a.target.value;r!==i&&(i=r,null!==l&&e.cancel(l),l=e(function(){s.applyFilter(a.target.value,t.predicate,o),l=null},c))})}}}]),e.module("smart-table").directive("stSelectFilter",["$interpolate","$log",function(e,t){return{replace:!0,require:"^stTable",scope:{predicate:"=?stSelectFilter",attrOptions:"=?options",attSelected:"=?selected",comparator:"&"},template:function(e,t){var a=t.emptyLabel?t.emptyLabel:"";return'<select data-ng-model="selected" data-ng-options="option.value as option.label for option in options"><option value="">'+a+"</option></select>"},link:function(r,n,i,s){var l,c=s,o="selectFilter";if(i.comparator){var u=r.comparator(),p=o+"_"+u.name;l=s.registerFilter(p,u,null)}else l=s.registerFilter(o,!0,null);if(r.attrOptions?r.options=r.attrOptions.length>0&&"object"==typeof r.attrOptions[0]?r.attrOptions.slice(0):a(r.attrOptions):((angular.isUndefined(r.predicate)||""===r.predicate)&&t.error("Empty predicate value not allowed for st-select-filter"),"$"===r.predicate&&t.error("Predicate value '$' only allowed for st-select-filter when combined with attribute 'options'"),r.options=a(s.getUniqueValues(r.predicate)),r.$on("st-safeSrcChanged",function(){r.options=a(s.getUniqueValues(r.predicate)),null===r.selected||r.options.some(function(e){return e.value===r.selected})||(r.selected=null,c.applyFilter(r.selected,r.predicate,l))})),i.label){var f=i.label.replace("[[","{{").replace("]]","}}"),d=e(f);r.options.forEach(function(e){e.label=d(e)})}n.on("change",function(){return angular.isUndefined(r.predicate)||""===r.predicate?(t.error("Empty predicate not allowed, assign a predicate value to st-select-filter. Use '$' to filter globally."),void 0):(c.applyFilter(r.selected,r.predicate,l),r.$parent.$digest(),void 0)}),r.$watch(function(){return l.predicateObject},function(e,t){if(e!==t){var a=e,i=r.predicate||"$";a&&a[i]!==n[0].value&&(r.attSelected=a[i]||"")}},!0),r.$watch(function(){return r.attSelected},function(e,t){if(e===t){if(e&&""!==e){var a=r.predicate||"$";l.predicateObject[a]=e,r.selected=e}}else{var n=r.options.some(function(t){return t.value===e});r.attSelected=n?e:null,r.selected!==r.attSelected&&(r.selected=r.attSelected,c.applyFilter(r.selected,r.predicate,l))}})}}}]),e.module("smart-table").directive("stSelectRow",function(){return{restrict:"A",require:"^stTable",scope:{row:"=stSelectRow"},link:function(e,t,a,r){var n=a.stSelectMode||"single";t.bind("click",function(){e.$apply(function(){r.select(e.row,n)})}),e.$watch("row.isSelected",function(e){e===!0?t.addClass("st-selected"):t.removeClass("st-selected")})}}}),e.module("smart-table").directive("stSort",["$parse",function(a){return{restrict:"A",require:"^stTable",link:function(r,n,i,s){function l(){p++,o=e.isFunction(u(r))?u(r):i.stSort,p%3===0&&i.stSkipNatural===t?(p=0,s.tableState().sort={},s.tableState().pagination.start=0,s.pipe()):s.sortBy(o,p%2===0)}var c,o=i.stSort,u=a(o),p=0,f=i.stClassAscent||"st-sort-ascent",d=i.stClassDescent||"st-sort-descent",g=[f,d];i.stSortDefault&&(c=r.$eval(i.stSortDefault)!==t?r.$eval(i.stSortDefault):i.stSortDefault),n.bind("click",function(){o&&r.$apply(l)}),c&&(p="reverse"===i.stSortDefault?1:0,l()),r.$watch(function(){return s.tableState().sort},function(e){e.predicate!==o?(p=0,n.removeClass(f).removeClass(d)):(p=e.reverse===!0?2:1,n.removeClass(g[p%2]).addClass(g[p-1]))},!0)}}}]),e.module("smart-table").directive("stPagination",function(){return{restrict:"EA",require:"^stTable",scope:{stItemsByPage:"=?",stDisplayedPages:"=?",stPageChange:"&"},templateUrl:function(e,t){return t.stTemplate?t.stTemplate:"template/smart-table/pagination.html"},link:function(e,t,a,r){function n(){var t,a,n=r.tableState().pagination,i=1,s=e.currentPage;for(e.currentPage=Math.floor(n.start/n.number)+1,i=Math.max(i,e.currentPage-Math.abs(Math.floor(e.stDisplayedPages/2))),t=i+e.stDisplayedPages,t>n.numberOfPages&&(t=n.numberOfPages+1,i=Math.max(1,t-e.stDisplayedPages)),e.pages=[],e.numPages=n.numberOfPages,a=i;t>a;a++)e.pages.push(a);s!==e.currentPage&&e.stPageChange({newPage:e.currentPage})}e.stItemsByPage=e.stItemsByPage?+e.stItemsByPage:10,e.stDisplayedPages=e.stDisplayedPages?+e.stDisplayedPages:5,e.currentPage=1,e.pages=[],e.$watch(function(){return r.tableState().pagination},n,!0),e.$watch("stItemsByPage",function(t,a){t!==a&&e.selectPage(1)}),e.$watch("stDisplayedPages",n),e.selectPage=function(t){t>0&&t<=e.numPages&&r.slice((t-1)*e.stItemsByPage,e.stItemsByPage)},r.tableState().pagination.number||r.slice(0,e.stItemsByPage)}}}),e.module("smart-table").directive("stPipe",function(){return{require:"stTable",scope:{stPipe:"="},link:{pre:function(t,a,r,n){e.isFunction(t.stPipe)&&(n.preventPipeOnWatch(),n.pipe=function(){return t.stPipe(n.tableState(),n)})},post:function(e,t,a,r){r.pipe()}}}})}(angular);